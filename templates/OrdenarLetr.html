<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700,800&display=swap" rel="stylesheet">
    <title>Construye la Palabra</title>
    <style>
        /* Estilos del juego */
        body {
            background-image: url("{{ url_for('static', filename='imgs/Luna.gif') }}");
            background-size: cover; /* Para cubrir toda la pantalla */
            background-position: center; /* Para centrar el fondo */
            font-family: 'Open Sans', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            height: 100vh;
            margin: 0;
        }

        header {
            align-self: flex-end;
            margin-top: 20px;
            margin-right: 20px;
        }

        #game-container {
            text-align: center;
            max-width: 1000px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            margin-bottom: 3%;
        }

        #word-container {
            font-size: 24px;
            margin-bottom: 5px;
        }

        #letters-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .letter {
            cursor: pointer;
            padding: 10px;
            border: 2px solid #3498db;
            border-radius: 5px;
            margin: 5px;
            background-color: #60ade0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .letter img {
            width: 80px;
            height: 80px;
            object-fit: contain;
        }

        h1 {
            font-size: 80px;
            color: #dfe0e2;
            text-align: center;
            margin-bottom: 80px;
        }

        nav {
            text-align: right;
            margin-top: 20px;
            margin-right: 20px;
        }

        nav > a {
            color: #fff;
            font-weight: 300;
            text-decoration: none;
            margin-right: 10px;
        }

        nav > a:hover {
            text-decoration: underline;
        }

        .boton-especial {
            padding: 15px 30px;
            background-color: #ffffff;
            color: #5478e3;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-left: 60%;
        }

        #message {
            font-size: 40px;
            color: rgb(255, 255, 255);
            display: none;
        }

    </style>
</head>

<body>

<header>
    <nav>
        <a href="/">Inicio</a>
        <a href="/acercade">Acerca de nosotros</a>
        <a href="/aprende">Aprende</a>
        <a href="/juegos">Juegos</a>
    </nav>
</header>

<h1>Ordena la Palabra</h1>

<div id="game-container">
    <div id="word-container"></div>
    <div id="letters-container"></div>
    <div id="attempts-container"></div>
</div>

<div id="message"></div>

<script>
    const palabras = ["HOLA", "HOGAR", "LENGUAJE", "SONREIR", "JUGAR", "COMER", "SALUDAR", "AMIGOS"];
    let palabrasRestantes = [...palabras];

    let palabraActual;
    let palabraDesordenada;
    let palabraMostrada;
    let intentos;

    function iniciarJuego() {
        if (palabrasRestantes.length === 0) {
            window.location.href = "/juegos/ordenapalabras/felicidades";
            return;
        }

        palabraActual = seleccionarPalabraSiguiente();
        palabraDesordenada = desordenarPalabra(palabraActual);
        palabraMostrada = '';
        intentos = palabraActual.length + 4;

        mostrarPalabraDesordenada();
        mostrarPalabraOrdenada();
        mostrarLetras();
        mostrarIntentos();
    }

    function seleccionarPalabraSiguiente() {
        const palabraSeleccionada = palabrasRestantes.shift();
        return palabraSeleccionada;
    }

    function desordenarPalabra(palabra) {
        return palabra.split('').sort(() => Math.random() - 0.5).join('').split('').sort(() => Math.random() - 0.5).join('');
    }

    function mostrarPalabraDesordenada() {
        const wordContainer = document.getElementById('word-container');
        wordContainer.textContent = palabraActual;
    }

    function mostrarPalabraOrdenada() {
        const attemptsContainer = document.getElementById('attempts-container');
        attemptsContainer.textContent = '';
    }

    function mostrarLetras() {
        const lettersContainer = document.getElementById('letters-container');
        lettersContainer.innerHTML = '';

        let shuffledLetters = shuffle([...palabraDesordenada]);

        for (let letra of shuffledLetters) {
            const letraElemento = document.createElement('div');
            letraElemento.className = 'letter';
            letraElemento.addEventListener('click', () => seleccionarLetra(letra));

            const imgElemento = document.createElement('img');

            const nuevaUrl = "{{ url_for('static', filename='imgsSenas/LETRA.png') }}".replace('LETRA', letra);

            imgElemento.src = nuevaUrl;
            imgElemento.alt = letra;

            letraElemento.appendChild(imgElemento);
            lettersContainer.appendChild(letraElemento);
        }
    }

    function mostrarIntentos() {
        const attemptsContainer = document.getElementById('attempts-container');
        attemptsContainer.textContent = `Intentos restantes: ${intentos}`;
    }

    function seleccionarLetra(letra) {
        if (letra === palabraActual[0]) {
            palabraActual = palabraActual.slice(1);
            palabraMostrada += letra;
            palabraDesordenada = palabraActual;

            if (palabraActual.length === 0) {
                if (palabraMostrada === "AMIGOS") {
                    mostrarFelicitaciones();
                } else {
                    reiniciarJuego();
                }
                mostrarMensaje('¡Perfecto, sigue así!');
            }
        } else {
            intentos--;

            if (intentos === 0) {
                mostrarMensaje('¡Agotaste tus intentos! Sigue intentando');
                reiniciarJuego();
            }
        }

        mostrarPalabraDesordenada();
        mostrarPalabraOrdenada();
        mostrarLetras();
        mostrarIntentos();
    }

    function mostrarFelicitaciones() {
        window.location.href = "/juegos/ordenapalabras/felicidades";
    }

    function reiniciarJuego() {
        if (palabrasRestantes.length === 0) {
            palabrasRestantes = [...palabras];
        }
        iniciarJuego();
    }

    function shuffle(array) {
        let currentIndex = array.length, randomIndex;

        while (currentIndex !== 0) {
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex--;

            [array[currentIndex], array[randomIndex]] = [
                array[randomIndex], array[currentIndex]
            ];
        }

        return array;
    }

    function mostrarMensaje(texto) {
        const messageContainer = document.getElementById('message');
        messageContainer.textContent = texto;
        messageContainer.style.display = 'block';
        setTimeout(() => {
            messageContainer.textContent = '';
            messageContainer.style.display = 'none';
        }, 3000);
    }

    document.addEventListener('DOMContentLoaded', iniciarJuego);

</script>
</body>

</html>
